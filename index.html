<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#222f3e">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="LinguaVox">

    <title>LinguaVox| Mobile Ready</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap');
        :root {
            --primary:#00d2d3;
            --primary-dark:#01a3a4;
            --bg:#222f3e;
            --card:#2e3d4f;
            --text:#c8d6e5;
            --input-bg:#1e2836;
            --border:#1e2836;
        }
        body.light-mode {
            --primary:#0984e3;
            --primary-dark:#74b9ff;
            --bg:#f1f2f6;
            --card:#fff;
            --text:#2f3542;
            --input-bg:#dfe4ea;
            --border:#ced6e0;
        }
        body{
            margin:0;
            font-family:'Outfit',sans-serif;
            background:var(--bg);
            color:var(--text);
            display:flex;
            justify-content:center;
            align-items:center;
            min-height:100vh;
        }
        .container{
            width:90%;
            max-width:500px;
            background:var(--card);
            padding:30px;
            border-radius:24px;
            box-shadow:0 20px 60px rgba(0,0,0,.4);
        }
        textarea{
            width:100%;
            height:100px;
            background:var(--input-bg);
            border:2px solid var(--border);
            border-radius:16px;
            color:var(--text);
            padding:15px;
            font-size:16px;
            resize:none;
        }
        select{
            width:100%;
            padding:14px;
            margin-top:10px;
            border-radius:12px;
            background:var(--input-bg);
            border:2px solid var(--border);
            color:var(--text);
            font-size:16px;
        }
        .main-btn{
            width:100%;
            margin-top:15px;
            padding:16px;
            border:none;
            border-radius:50px;
            background:linear-gradient(135deg,var(--primary),var(--primary-dark));
            color:#fff;
            font-weight:700;
            cursor:pointer;
        }
        .translation-output{
            margin-top:15px;
            padding:20px;
            background:rgba(0,0,0,.1);
            border-radius:12px;
            color:var(--primary);
            font-size:1.1rem;
            display:none;
        }
        input[type=range]{accent-color:var(--primary)}
    </style>
</head>

<body>

<div class="container">
    <h1>LinguaVox</h1>

    <textarea id="text-input" placeholder="Type here..."></textarea>

    <select id="lang-select">
        <option value="mr-IN">ğŸ‡®ğŸ‡³ Marathi</option>
        <option value="hi-IN">ğŸ‡®ğŸ‡³ Hindi</option>
        <option value="ta-IN">ğŸ‡®ğŸ‡³ Tamil</option>
        <option value="te-IN">ğŸ‡®ğŸ‡³ Telugu</option>
        <option value="bn-IN">ğŸ‡®ğŸ‡³ Bengali</option>
        <option value="gu-IN">ğŸ‡®ğŸ‡³ Gujarati</option>
        <option value="kn-IN">ğŸ‡®ğŸ‡³ Kannada</option>
        <option value="ml-IN">ğŸ‡®ğŸ‡³ Malayalam</option>
        <option value="pa-IN">ğŸ‡®ğŸ‡³ Punjabi</option>
        <option value="ur-PK">ğŸ‡µğŸ‡° Urdu</option>

        <option value="en-US">ğŸ‡ºğŸ‡¸ English</option>

        <option value="es-ES">ğŸ‡ªğŸ‡¸ Spanish</option>
        <option value="fr-FR">ğŸ‡«ğŸ‡· French</option>
        <option value="de-DE">ğŸ‡©ğŸ‡ª German</option>
        <option value="it-IT">ğŸ‡®ğŸ‡¹ Italian</option>
        <option value="pt-PT">ğŸ‡µğŸ‡¹ Portuguese</option>
        <option value="nl-NL">ğŸ‡³ğŸ‡± Dutch</option>
        <option value="ru-RU">ğŸ‡·ğŸ‡º Russian</option>
        <option value="pl-PL">ğŸ‡µğŸ‡± Polish</option>
        <option value="tr-TR">ğŸ‡¹ğŸ‡· Turkish</option>

        <option value="ja-JP">ğŸ‡¯ğŸ‡µ Japanese</option>
        <option value="ko-KR">ğŸ‡°ğŸ‡· Korean</option>
        <option value="zh-CN">ğŸ‡¨ğŸ‡³ Chinese</option>
        <option value="th-TH">ğŸ‡¹ğŸ‡­ Thai</option>
        <option value="vi-VN">ğŸ‡»ğŸ‡³ Vietnamese</option>
        <option value="id-ID">ğŸ‡®ğŸ‡© Indonesian</option>

        <option value="ar-SA">ğŸ‡¸ğŸ‡¦ Arabic</option>
        <option value="fa-IR">ğŸ‡®ğŸ‡· Persian</option>
        <option value="he-IL">ğŸ‡®ğŸ‡± Hebrew</option>
        <option value="sw-KE">ğŸ‡°ğŸ‡ª Swahili</option>
    </select>

    <label>Speech Speed
        <input type="range" id="speed-slider" min="0.5" max="1.5" step="0.1" value="1">
    </label>

    <button id="translate-btn" class="main-btn">Translate & Speak</button>

    <div id="output-box" class="translation-output"></div>
</div>

<script>
const textarea = document.getElementById("text-input");
const langSelect = document.getElementById("lang-select");
const translateBtn = document.getElementById("translate-btn");
const outputBox = document.getElementById("output-box");
const speedSlider = document.getElementById("speed-slider");

/* --------- TRANSLATE & SPEAK (JAPANESE FIX ONLY) --------- */
async function translateAndSpeak() {
    const text = textarea.value;
    const targetLang = langSelect.value;
    if (!text) return alert("Please enter text first.");

    translateBtn.innerText = "Processing...";
    outputBox.style.display = "block";
    outputBox.innerText = "Translating...";

    try {
        const apiLang = targetLang.split("-")[0];
        let translatedText = "";

        /* âœ… ONLY CHANGE: Japanese handled separately */
        if (apiLang === "ja") {
            const res = await fetch("https://libretranslate.de/translate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    q: text,
                    source: "en",
                    target: "ja",
                    format: "text"
                })
            });
            const data = await res.json();
            translatedText = data.translatedText;
        } else {
            const res = await fetch(
                `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=en|${apiLang}`
            );
            const data = await res.json();
            translatedText = data.responseData.translatedText;
        }

        outputBox.innerText = translatedText;
        speak(translatedText, targetLang);

    } catch {
        outputBox.innerText = "Error. Try again.";
    }

    translateBtn.innerText = "Translate & Speak";
}

/* --------- SPEECH (UNCHANGED) --------- */
function speak(text, lang) {
    speechSynthesis.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = lang;
    utter.rate = speedSlider.value;

    const voices = speechSynthesis.getVoices();
    const voice = voices.find(v => v.lang.includes(lang.split("-")[0]));
    if (voice) utter.voice = voice;

    speechSynthesis.speak(utter);
}

translateBtn.addEventListener("click", translateAndSpeak);
speechSynthesis.onvoiceschanged = () => speechSynthesis.getVoices();
</script>

</body>
</html>
